# 前端优化任务清单

## 背景
- 当前前端逻辑主要集中在 `frontend/src/App.js`，代码耦合较高，不利于扩展和定位问题。
- 时间一览和智能相册目前都在同页内切换，你希望点击后在新标签页打开完整内容。
- 地点识别存在明显错误（例如上海照片被识别为南美地点），需要修复地理信息解析与反查逻辑。
- UI 观感可继续提升，考虑引入 Tailwind CSS 做统一美化与组件化样式管理。

## 总目标
1. 重构前端代码结构（页面化、组件化）。
2. 实现“时间一览日期 / 智能相册”新标签页详情查看。
3. 修复地点识别准确性问题。
4. 评估并落地 Tailwind CSS 界面美化方案。

## 阶段一：前端结构重构
### 任务
- 新建 `frontend/src/pages/` 并拆分页面：
  - `TimelinePage.jsx`
  - `AlbumsPage.jsx`
  - `MapPage.jsx`
  - `DateDetailPage.jsx`（新增）
  - `AlbumDetailPage.jsx`（新增）
- 新建 `frontend/src/components/` 复用组件：
  - `Navigation.jsx`
  - `MediaGrid.jsx`
  - `MediaCard.jsx`
  - `LazyImage.jsx`
  - `ScanControls.jsx`
- `App.js` 仅保留路由和全局布局，不承载页面业务细节。
- 将状态和逻辑沉淀到 `frontend/src/hooks/`：
  - `useMediaList`
  - `useInfiniteScroll`
  - `useScanStatus`（可选）

### 验收标准
- `App.js` 不再包含大段页面渲染逻辑。
- 各页面可独立维护，功能无回归（扫描、懒加载、Lightbox、筛选正常）。

## 阶段二：新标签页详情页
### 时间一览 -> 日期详情页
- 在日期组头部提供“查看当日全部”入口。
- 点击后新标签页打开：`/date/:dateKey`（如 `2026-02-07`）。
- `DateDetailPage` 展示该日期全部媒体并支持 Lightbox。

### 智能相册 -> 相册详情页
- 相册卡片点击后新标签页打开：`/album/:albumName`。
- `AlbumDetailPage` 展示该相册全部媒体并支持 Lightbox。

### 数据接口（建议）
- 优先后端过滤，避免前端一次性处理全量：
  - `GET /api/media/by-date?date=YYYY-MM-DD`
  - `GET /api/media/by-album?name=camera|screenshot|video|web`
- 若接口尚未就绪，可短期前端过滤，但后端过滤为目标形态。

### 验收标准
- 日期和相册均可在新标签页打开详情。
- 详情页支持完整浏览与大图/视频查看。

## 阶段三：地点识别修复
### 排查方向
- EXIF GPS 解析异常（经纬度分量或正负号处理错误）。
- 无效坐标仍参与反查导致错误地名。
- 反向地理库结果命名策略不适配（地点粒度不合理）。

### 后端改造（`backend/scanner.py`）
- 增加 GPS 严格校验：
  - 纬度范围 `[-90, 90]`
  - 经度范围 `[-180, 180]`
- 对异常值/缺失值直接跳过反查，避免误标。
- 统一地点命名策略（建议：`country + admin1 + city`）。
- 选取上海样本复扫验证。

### 验收标准
- 上海样本应稳定显示上海相关地名。
- 无效 GPS 不再生成误导性地点标签。
- 扫描过程稳定无异常中断。

## 阶段四：UI 美化（Tailwind CSS 方案）
### 任务
- 评估并引入 Tailwind CSS（含 `postcss` 配置与目录扫描配置）。
- 将核心页面样式迁移为 Tailwind utility class（先做时间页/相册页）。
- 建立统一设计变量（色彩、间距、圆角、阴影、字体层级）。
- 对高负载视觉效果设置“低性能模式”开关（弱化模糊、阴影、动画）。

### 验收标准
- 视觉一致性提升，界面更现代、层次更清晰。
- 低性能设备滚动更稳定，不引入明显掉帧。
- 与现有功能兼容，不影响扫描与浏览流程。

## 验证计划
1. 仅启动后端，扫描测试目录 `tmp_test_media_500`。
2. 启动前端，验证时间页/相册页的新标签页行为。
3. 使用上海样本验证地点准确性。
4. 执行 `npm run build`，确保构建通过。

## 实施顺序
1. 阶段一（结构重构）
2. 阶段二（新标签页详情）
3. 阶段三（地点修复）
4. 阶段四（Tailwind 美化）

## 完成定义（DoD）
- 页面结构重构完成且无功能回归。
- 日期与相册新标签页详情功能完整可用。
- 地点识别问题在样本上修复。
- 前端构建与本地冒烟测试通过。

## 紧急修复（新增）
### Smart 一览布局崩坏（高优先级）
- 问题现象：
  - Smart 一览（`/albums`）出现卡片错位、文字遮挡、覆盖层与缩略图层级异常，影响可用性。
- 修复动作：
  - 统一相册卡片 DOM 结构，避免 `a` 标签和绝对定位层叠导致的布局断裂。
  - 修复 `album-overlay` 的定位和层级，保证在任意屏宽下都与卡片绑定。
  - 增加响应式断点规则（至少覆盖 360px、768px、1280px）。
  - 为空相册提供稳定占位样式，避免高度塌陷。
- 验收标准：
  - `/albums` 页面在桌面和移动端均无错位、遮挡、溢出。
  - 相册标题与数量信息稳定可读，点击区域完整。
  - `npm run build` 通过，且不引入新的布局回归。
